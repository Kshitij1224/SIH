<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile • MedX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50">
  <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="#2563eb" xmlns="http://www.w3.org/2000/svg" class="mr-3">
            <title>MedX</title>
            <path d="M12 21s-1.45-1.186-3.05-2.614C6.22 16.838 2 13.323 2 9.25 2 6.35 4.35 4 7.25 4c1.62 0 3.12.76 4.08 1.96C12.29 4.76 13.78 4 15.4 4 18.3 4 20.65 6.35 20.65 9.25c0 4.073-4.22 7.588-6.95 9.136C13.45 19.814 12 21 12 21z"/>
          </svg>
          <span class="text-2xl font-bold text-gray-900">MedX</span>
        </div>
        <a id="backBtn" href="#" class="text-sm text-blue-600 hover:text-blue-700">Back to Dashboard</a>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-6 py-8">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-1">Your Profile</h1>
        <p class="text-gray-600">Personal info, vitals, medications, labs and more</p>
      </div>
      <div class="flex gap-2">
        <button id="editBtn" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-sm">Edit</button>
        <button id="exportBtn" class="px-4 py-2 rounded-lg bg-gray-900 text-white hover:bg-gray-800 text-sm">Export PDF</button>
      </div>
    </div>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left: Profile card + Quick stats -->
      <div class="lg:col-span-1 space-y-6">
        <div class="p-6 rounded-xl border border-gray-200 bg-white">
          <div class="flex items-center gap-4">
            <img id="avatar" class="w-20 h-20 rounded-full object-cover" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Profile avatar" />
            <div>
              <div id="name" class="text-xl font-semibold text-gray-900">Jane Doe</div>
              <div id="email" class="text-sm text-gray-600">jane.doe@example.com</div>
              <div id="phone" class="text-sm text-gray-600 mt-1">+91 98765 43210</div>
            </div>
          </div>
          <div class="mt-5 grid grid-cols-2 gap-3 text-sm">
            <div class="p-3 rounded-lg bg-gray-50">
              <div class="text-gray-500">Age</div>
              <div id="age" class="font-medium text-gray-900">28</div>
            </div>
            <div class="p-3 rounded-lg bg-gray-50">
              <div class="text-gray-500">Blood</div>
              <div id="blood" class="font-medium text-gray-900">O+</div>
            </div>
            <div class="p-3 rounded-lg bg-gray-50">
              <div class="text-gray-500">Gender</div>
              <div id="gender" class="font-medium text-gray-900">Female</div>
            </div>
            <div class="p-3 rounded-lg bg-gray-50">
              <div class="text-gray-500">BMI</div>
              <div id="bmi" class="font-medium text-gray-900">21.6</div>
            </div>
          </div>
          <div class="mt-5">
            <div class="text-sm text-gray-500 mb-2">Health Score</div>
            <div class="w-full bg-gray-100 rounded-full h-2">
              <div id="healthScoreBar" class="bg-emerald-500 h-2 rounded-full" style="width: 78%"></div>
            </div>
            <div id="healthScoreText" class="mt-1 text-xs text-gray-600">78 • Good</div>
          </div>
        </div>

        <div class="p-6 rounded-xl border border-gray-200 bg-white">
          <h2 class="text-sm font-semibold text-gray-900 mb-3">Allergies</h2>
          <div id="allergies" class="flex flex-wrap gap-2">
            <span class="px-2 py-1 rounded-full bg-amber-100 text-amber-800 text-xs">Penicillin</span>
            <span class="px-2 py-1 rounded-full bg-amber-100 text-amber-800 text-xs">Peanuts</span>
          </div>
        </div>
      </div>

      <!-- Right: Tabs with content -->
      <div class="lg:col-span-2">
        <div class="rounded-xl border border-gray-200 bg-white">
          <div class="flex overflow-x-auto border-b border-gray-200 text-sm">
            <button data-tab="overview" class="tab-btn px-4 py-3 text-blue-600 border-b-2 border-blue-600">Overview</button>
            <button data-tab="vitals" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Vitals</button>
            <button data-tab="medications" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Medications</button>
            <button data-tab="conditions" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Conditions</button>
            <button data-tab="appointments" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Appointments</button>
            <button data-tab="labs" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Labs</button>
            <button data-tab="immunizations" class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600">Immunizations</button>
          </div>

          <!-- Tab panels -->
          <div class="p-6 space-y-6">
            <!-- Overview -->
            <section id="tab-overview" class="tab-panel">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 rounded-lg bg-gray-50">
                  <div class="text-sm text-gray-500 mb-2">Recent Vitals</div>
                  <canvas id="vitalsChart" height="140"></canvas>
                </div>
                <div class="p-4 rounded-lg bg-gray-50">
                  <div class="text-sm text-gray-500 mb-2">Risk Flags</div>
                  <ul id="riskFlags" class="space-y-2 text-sm">
                    <li class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-amber-500"></span> BP slightly elevated</li>
                    <li class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500"></span> Stable weight trend</li>
                  </ul>
                </div>
              </div>
            </section>

            <!-- Vitals -->
            <section id="tab-vitals" class="tab-panel hidden">
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div class="p-3 rounded-lg bg-gray-50">
                  <div class="text-gray-500">Height</div>
                  <div id="height" class="font-medium text-gray-900">164 cm</div>
                </div>
                <div class="p-3 rounded-lg bg-gray-50">
                  <div class="text-gray-500">Weight</div>
                  <div id="weight" class="font-medium text-gray-900">58 kg</div>
                </div>
                <div class="p-3 rounded-lg bg-gray-50">
                  <div class="text-gray-500">BP</div>
                  <div id="bp" class="font-medium text-gray-900">124/82</div>
                </div>
                <div class="p-3 rounded-lg bg-gray-50">
                  <div class="text-gray-500">Pulse</div>
                  <div id="pulse" class="font-medium text-gray-900">74 bpm</div>
                </div>
              </div>
            </section>

            <!-- Medications -->
            <section id="tab-medications" class="tab-panel hidden">
              <ul id="medList" class="space-y-3 text-sm"></ul>
            </section>

            <!-- Conditions -->
            <section id="tab-conditions" class="tab-panel hidden">
              <ul id="condList" class="space-y-3 text-sm"></ul>
            </section>

            <!-- Appointments -->
            <section id="tab-appointments" class="tab-panel hidden">
              <ul id="apptList" class="space-y-3 text-sm"></ul>
            </section>

            <!-- Labs -->
            <section id="tab-labs" class="tab-panel hidden">
              <ul id="labList" class="space-y-3 text-sm"></ul>
            </section>

            <!-- Immunizations -->
            <section id="tab-immunizations" class="tab-panel hidden">
              <ul id="immList" class="space-y-3 text-sm"></ul>
            </section>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Load a profile object from localStorage if available; else defaults above will show
    function applyProfile(p) {
      if (!p) return;
      const $ = (id) => document.getElementById(id);
      if (p.name) $('name').textContent = p.name;
      if (p.email) $('email').textContent = p.email;
      if (p.phone) $('phone').textContent = p.phone;
      if (p.avatar) document.getElementById('avatar').src = p.avatar;
      if (p.age) $('age').textContent = p.age;
      if (p.blood) $('blood').textContent = p.blood;
      if (p.gender) $('gender').textContent = p.gender;
      if (p.height) $('height').textContent = p.height;
      if (p.weight) $('weight').textContent = p.weight;
      if (p.bmi) $('bmi').textContent = p.bmi;
      if (Array.isArray(p.allergies)) {
        const wrap = document.getElementById('allergies');
        wrap.innerHTML = '';
        p.allergies.forEach(a => {
          const span = document.createElement('span');
          span.className = 'px-2 py-1 rounded-full bg-amber-100 text-amber-800 text-xs';
          span.textContent = a;
          wrap.appendChild(span);
        });
      }
    }

    try {
      const raw = localStorage.getItem('userProfile');
      if (raw) {
        const parsed = JSON.parse(raw);
        if (parsed && typeof parsed === 'object') applyProfile(parsed);
      }
    } catch {}

    document.getElementById('backBtn').addEventListener('click', (e) => {
      e.preventDefault();
      window.location.href = '/patient/dashboard';
    });

    document.getElementById('editBtn').addEventListener('click', () => {
      alert('Editing is not implemented yet. Provide a form or integrate with your app profile editor.');
    });

    // Tabs logic
    const tabButtons = document.querySelectorAll('.tab-btn');
    const panels = document.querySelectorAll('.tab-panel');
    tabButtons.forEach(btn => btn.addEventListener('click', () => {
      const key = btn.getAttribute('data-tab');
      tabButtons.forEach(b => b.classList.remove('text-blue-600','border-b-2','border-blue-600'));
      tabButtons.forEach(b => b.classList.add('text-gray-600'));
      btn.classList.add('text-blue-600','border-b-2','border-blue-600');
      panels.forEach(p => p.classList.add('hidden'));
      document.getElementById(`tab-${key}`).classList.remove('hidden');
    }));

    // Sample data if not present
    const fallbackHistory = [
      { id: 's1', date: '2025-09-10', timeSlot: '10:00 AM', doctor: 'Dr. Neha Mishra (General Physician)', locationType: 'In-Person (KIMS Hospital, KIIT)', reason: 'Fever and body ache' },
      { id: 's2', date: '2025-08-22', timeSlot: '03:00 PM', doctor: 'Dr. R. Mohanty (Dermatologist)', locationType: 'Video Consultation (Online)', reason: 'Skin rash and irritation' },
      { id: 's3', date: '2025-07-05', timeSlot: '11:30 AM', doctor: 'Dr. K. Sahu (Orthopedic)', locationType: 'In-Person (AMRI Hospitals, Khandagiri)', reason: 'Left knee pain' },
    ];

    function loadHistory() {
      try {
        const raw = localStorage.getItem('medicalHistory');
        if (!raw) return fallbackHistory;
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) && parsed.length ? parsed : fallbackHistory;
      } catch { return fallbackHistory; }
    }

    // Render appointments
    const apptList = document.getElementById('apptList');
    loadHistory().forEach(h => {
      const li = document.createElement('li');
      li.className = 'p-4 rounded-lg border border-gray-200 bg-white flex items-start justify-between';
      li.innerHTML = `
        <div>
          <div class="text-sm font-medium text-gray-900">${h.doctor}</div>
          <div class="text-xs text-gray-600">${h.reason || ''}</div>
          <div class="mt-1 flex flex-wrap items-center gap-2 text-[11px]">
            <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">${h.date}</span>
            <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">${h.timeSlot}</span>
            <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">${h.locationType}</span>
          </div>
        </div>
        <button class="text-xs text-blue-600 hover:text-blue-700">Details</button>
      `;
      apptList.appendChild(li);
    });

    // Render medications (sample)
    const meds = [
      { name: 'Atorvastatin 10mg', schedule: 'Once daily (night)', adherence: 0.92 },
      { name: 'Metformin 500mg', schedule: 'Twice daily', adherence: 0.85 },
      { name: 'Vitamin D3 1000 IU', schedule: 'Once daily', adherence: 0.98 },
    ];
    const medList = document.getElementById('medList');
    meds.forEach(m => {
      const pct = Math.round(m.adherence * 100);
      const li = document.createElement('li');
      li.className = 'p-4 rounded-lg border border-gray-200 bg-white';
      li.innerHTML = `
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-gray-900">${m.name}</div>
            <div class="text-xs text-gray-600">${m.schedule}</div>
          </div>
          <div class="w-28">
            <div class="w-full h-2 bg-gray-100 rounded-full">
              <div class="h-2 bg-emerald-500 rounded-full" style="width:${pct}%"></div>
            </div>
            <div class="text-[10px] text-right text-gray-500 mt-1">${pct}%</div>
          </div>
        </div>`;
      medList.appendChild(li);
    });

    // Render conditions (sample)
    const conds = [
      { name: 'Hypertension', since: '2022-04-01', status: 'Managed' },
      { name: 'Seasonal Allergic Rhinitis', since: '2019-09-10', status: 'Active' },
    ];
    const condList = document.getElementById('condList');
    conds.forEach(c => {
      const li = document.createElement('li');
      li.className = 'p-4 rounded-lg border border-gray-200 bg-white flex items-center justify-between';
      li.innerHTML = `
        <div>
          <div class="text-sm font-medium text-gray-900">${c.name}</div>
          <div class="text-xs text-gray-600">Since ${c.since}</div>
        </div>
        <span class="text-xs px-2 py-1 rounded-full ${c.status==='Managed' ? 'bg-emerald-100 text-emerald-800' : 'bg-amber-100 text-amber-800'}">${c.status}</span>
      `;
      condList.appendChild(li);
    });

    // Render labs (sample)
    const labs = [
      { name: 'HbA1c', value: '5.6%', ref: '4.0–5.6%', date: '2025-06-20' },
      { name: 'Total Cholesterol', value: '182 mg/dL', ref: '< 200 mg/dL', date: '2025-06-20' },
      { name: 'Vitamin D', value: '28 ng/mL', ref: '20–50 ng/mL', date: '2025-06-20' },
    ];
    const labList = document.getElementById('labList');
    labs.forEach(l => {
      const li = document.createElement('li');
      li.className = 'p-4 rounded-lg border border-gray-200 bg-white flex items-center justify-between';
      li.innerHTML = `
        <div>
          <div class="text-sm font-medium text-gray-900">${l.name}</div>
          <div class="text-xs text-gray-600">${l.date}</div>
        </div>
        <div class="text-right">
          <div class="text-sm font-medium text-gray-900">${l.value}</div>
          <div class="text-xs text-gray-500">Ref: ${l.ref}</div>
        </div>
      `;
      labList.appendChild(li);
    });

    // Render immunizations (sample)
    const imms = [
      { name: 'COVID-19 (Booster)', date: '2024-12-12' },
      { name: 'Influenza', date: '2024-10-02' },
      { name: 'Tetanus (Tdap)', date: '2023-08-14' },
    ];
    const immList = document.getElementById('immList');
    imms.forEach(i => {
      const li = document.createElement('li');
      li.className = 'p-4 rounded-lg border border-gray-200 bg-white flex items-center justify-between';
      li.innerHTML = `
        <div class="text-sm font-medium text-gray-900">${i.name}</div>
        <div class="text-xs text-gray-600">${i.date}</div>
      `;
      immList.appendChild(li);
    });

    // Overview vitals chart
    const ctx = document.getElementById('vitalsChart');
    if (ctx && window.Chart) {
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Apr','May','Jun','Jul','Aug','Sep'],
          datasets: [
            { label: 'Systolic BP', data: [126,128,130,124,122,124], borderColor: '#ef4444', tension: 0.35 },
            { label: 'Pulse', data: [76,74,78,74,72,74], borderColor: '#3b82f6', tension: 0.35 },
            { label: 'Weight (kg)', data: [58.5,58.2,58.0,57.8,57.9,58.0], borderColor: '#10b981', tension: 0.35, yAxisID: 'y1' },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: false },
            y1: { position: 'right', beginAtZero: false, grid: { drawOnChartArea: false } },
          },
          plugins: { legend: { labels: { boxWidth: 12, usePointStyle: true } } },
        }
      });
    }

  </script>
</body>
</html>
