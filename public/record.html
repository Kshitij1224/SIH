<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Records • MedX</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="#2563eb" xmlns="http://www.w3.org/2000/svg" class="mr-3">
            <title>MedX</title>
            <path d="M12 21s-1.45-1.186-3.05-2.614C6.22 16.838 2 13.323 2 9.25 2 6.35 4.35 4 7.25 4c1.62 0 3.12.76 4.08 1.96C12.29 4.76 13.78 4 15.4 4 18.3 4 20.65 6.35 20.65 9.25c0 4.073-4.22 7.588-6.95 9.136C13.45 19.814 12 21 12 21z"/>
          </svg>
          <span class="text-2xl font-bold text-gray-900">MedX</span>
        </div>
        <a id="backBtn" href="#" class="text-sm text-blue-600 hover:text-blue-700">Back to Dashboard</a>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-6 py-8">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-1">Your Records</h1>
        <p class="text-gray-600">All past, present and upcoming appointments in one place</p>
      </div>
      <div class="flex items-center gap-3">
        <input id="search" type="text" placeholder="Search doctor, reason, location..." class="w-64 px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <select id="sort" class="px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="desc">Newest first</option>
          <option value="asc">Oldest first</option>
          <option value="doctor">Doctor (A–Z)</option>
        </select>
      </div>
    </div>

    <section id="lists" class="space-y-8"></section>
  </main>

  <script>
    const sample = [
      { id: 's1', date: '2025-09-10', timeSlot: '10:00 AM', doctor: 'Dr. Neha Mishra (General Physician)', locationType: 'In-Person (KIMS Hospital, KIIT)', reason: 'Fever and body ache' },
      { id: 's2', date: '2025-08-22', timeSlot: '03:00 PM', doctor: 'Dr. R. Mohanty (Dermatologist)', locationType: 'Video Consultation (Online)', reason: 'Skin rash and irritation' },
      { id: 's3', date: '2025-07-05', timeSlot: '11:30 AM', doctor: 'Dr. K. Sahu (Orthopedic)', locationType: 'In-Person (AMRI Hospitals, Khandagiri)', reason: 'Left knee pain' },
    ];

    function loadHistory() {
      try {
        const raw = localStorage.getItem('medicalHistory');
        if (!raw) return sample;
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) && parsed.length ? parsed : sample;
      } catch {
        return sample;
      }
    }

    function categorize(items) {
      const todayStr = new Date().toISOString().slice(0,10);
      const past = [], today = [], future = [];
      for (const it of items) {
        if (it.date < todayStr) past.push(it); else if (it.date === todayStr) today.push(it); else future.push(it);
      }
      return { past, today, future };
    }

    function render() {
      const q = document.getElementById('search').value.toLowerCase();
      const sort = document.getElementById('sort').value;
      let data = loadHistory().filter(h =>
        h.doctor.toLowerCase().includes(q) || h.reason.toLowerCase().includes(q) || h.locationType.toLowerCase().includes(q)
      );
      if (sort === 'asc' || sort === 'desc') {
        data.sort((a,b) => a.date.localeCompare(b.date) * (sort==='asc'?1:-1));
      } else if (sort === 'doctor') {
        data.sort((a,b) => a.doctor.localeCompare(b.doctor));
      }

      const {past, today, future} = categorize(data);
      const lists = document.getElementById('lists');
      lists.innerHTML = '';
      const sections = [
        { title: 'Today', items: today },
        { title: 'Upcoming', items: future },
        { title: 'Past', items: past },
      ];

      for (const sec of sections) {
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <h2 class="text-xl font-semibold text-gray-900 mb-3">${sec.title}</h2>
          ${sec.items.length === 0 ? '<div class="text-sm text-gray-500">No records.</div>' : ''}
        `;
        if (sec.items.length) {
          const ul = document.createElement('ul');
          ul.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
          for (const h of sec.items) {
            const li = document.createElement('li');
            li.className = 'p-4 rounded-xl border border-gray-200 bg-white hover:shadow-sm transition-shadow';
            li.innerHTML = `
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="text-base font-semibold text-gray-900">${h.doctor}</div>
                  <div class="text-sm text-gray-600">${h.reason || ''}</div>
                  <div class="mt-2 flex flex-wrap items-center gap-2 text-xs">
                    <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">Date: ${h.date}</span>
                    <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">Time: ${h.timeSlot}</span>
                    <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700">${h.locationType}</span>
                  </div>
                </div>
                <div class="text-right">
                  <button class="text-sm text-blue-600 hover:text-blue-700">View</button>
                </div>
              </div>
            `;
            ul.appendChild(li);
          }
          wrap.appendChild(ul);
        }
        lists.appendChild(wrap);
      }
    }

    document.getElementById('search').addEventListener('input', () => render());
    document.getElementById('sort').addEventListener('change', () => render());
    document.getElementById('backBtn').addEventListener('click', (e) => {
      e.preventDefault();
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = '/';
      }
    });
    render();
  </script>
</body>
</html>
